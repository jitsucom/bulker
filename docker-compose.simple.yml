version: "3.8"

services:
  # Простая сборка и запуск только основного приложения Bulker
  # без внешних зависимостей для быстрого тестирования
  bulker-simple:
    build:
      context: .
      dockerfile: all.Dockerfile
      target: bulker
      args:
        - VERSION=test-build
        - BUILD_TIMESTAMP=2025-12-13
    container_name: bulker-simple
    ports:
      - "12000:3042"  # Используем порт 12000 для внешнего доступа
    environment:
      # Основные настройки
      - BULKER_HTTP_PORT=3042
      - BULKER_INSTANCE_ID=test-instance-simple
      
      # Аутентификация (простые токены для тестирования)
      - BULKER_RAW_AUTH_TOKENS=test-token-123,admin-token-456
      
      # Минимальные настройки без Kafka (для тестирования HTTP API)
      - BULKER_LOG_LEVEL=INFO
      - BULKER_LOG_FORMAT=json
      
      # Метрики
      - BULKER_METRICS_ENABLED=true
      - BULKER_METRICS_PORT=9090
    volumes:
      - bulker_simple_data:/app/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3042/ready"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s

volumes:
  bulker_simple_data:

networks:
  default:
    name: bulker-simple-network